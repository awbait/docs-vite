import{_ as s,c as n,o as a,a as l}from"./app.852d0fdd.js";const A=JSON.parse('{"title":"Fluend","description":"","frontmatter":{},"headers":[],"relativePath":"devops/kubernetes/configs/fluentd.md","lastUpdated":1665449255000}'),p={name:"devops/kubernetes/configs/fluentd.md"},t=l(`<h1 id="fluend" tabindex="-1">Fluend <a class="header-anchor" href="#fluend" aria-hidden="true">#</a></h1><p>\u0414\u043E\u043A\u0443\u043C\u0435\u043D\u0442\u0430\u0446\u0438\u044F \u043F\u043E \u0440\u0430\u0437\u0432\u0435\u0440\u0442\u044B\u0432\u0430\u043D\u0438\u044F\u043C:</p><p>!!! github &quot;[fluentd-kubernetes-daemonset]&quot; [fluentd-kubernetes-daemonset]: <a href="https://github.com/fluent/fluentd-kubernetes-daemonset" target="_blank" rel="noreferrer">https://github.com/fluent/fluentd-kubernetes-daemonset</a></p><p>!!! github &quot;\u0427\u0430\u0440\u0442 [fluentd]&quot; [fluentd]: <a href="https://github.com/fluent/helm-charts/tree/main/charts/fluentd" target="_blank" rel="noreferrer">https://github.com/fluent/helm-charts/tree/main/charts/fluentd</a></p><p>\u0414\u043B\u044F \u0442\u0435\u0441\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u044F \u043A\u043E\u043D\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u0438 \u0443\u0434\u043E\u0431\u043D\u043E \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u044C UI \u0432\u0435\u0440\u0441\u0438\u044E:</p><p>\u0411\u0438\u043B\u0434\u0438\u043C \u043A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">git clone https://github.com/fluent/fluentd-ui</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> fluentd-ui</span></span>
<span class="line"><span style="color:#A6ACCD;">docker build -t fluent/fluentd-ui:1.0.0 </span><span style="color:#82AAFF;">.</span></span>
<span class="line"></span></code></pre></div><p>\u0412 \u043F\u043E\u0441\u043B\u0435\u0434\u043D\u0435\u0439 \u0432\u0435\u0440\u0441\u0438\u0438, \u044F \u0437\u0430\u043C\u0435\u0442\u0438\u043B, \u0447\u0442\u043E \u0443 \u043A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440\u0430 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442\u0441\u044F CPU \u043F\u043E\u0434 \u043F\u043E\u0442\u043E\u043B\u043E\u043A, \u0438 \u0412\u041C\u043A\u0430 \u043F\u0430\u0434\u0430\u0435\u0442. \u0411\u0443\u0434\u044C\u0442\u0435 \u0432\u043D\u0438\u043C\u0430\u0442\u0435\u043B\u044C\u043D\u044B. \u041F\u043E\u0442\u0435\u0441\u0442\u0438\u043B\u0438 - \u043B\u0443\u0447\u0448\u0435 \u043E\u0444\u043D\u0443\u0442\u044C \u043A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440.</p><p>\u0417\u0430\u043F\u0443\u0441\u043A\u0430\u0435\u043C:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">docker run -d -v /var/log/fluent:/var/log -p 9292:9292 --name fluentui fluent/fluentd-ui:1.0.0</span></span>
<span class="line"></span></code></pre></div><p>\u0412\u044B\u043A\u043B\u044E\u0447\u0438\u0442\u044C:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">docker stop fluentui</span></span>
<span class="line"></span></code></pre></div><p>\u0417\u0430\u0439\u0442\u0438 \u0432 \u043A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">docker </span><span style="color:#82AAFF;">exec</span><span style="color:#A6ACCD;"> -it fluentui /bin/bash</span></span>
<span class="line"></span></code></pre></div><p>\u0418\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u043C\u044B\u0435 \u043F\u043B\u0430\u0433\u0438\u043D\u044B:</p><p>!!! github &quot;[fluent-plugin-multi-format-parser]&quot; [fluent-plugin-multi-format-parser]: <a href="https://github.com/repeatedly/fluent-plugin-multi-format-parser" target="_blank" rel="noreferrer">https://github.com/repeatedly/fluent-plugin-multi-format-parser</a></p><p>\u0423\u0441\u0442\u0430\u043D\u043E\u0432\u043A\u0430:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">fluent-gem install fluent-plugin-multi-format-parser</span></span>
<span class="line"></span></code></pre></div><div class="language-xml"><button class="copy"></button><span class="lang">xml</span><pre><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">source</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  @type tail</span></span>
<span class="line"><span style="color:#A6ACCD;">  path /var/log/atlassian.log</span></span>
<span class="line"><span style="color:#A6ACCD;">  pos_file /var/log/atlassian.log.pos</span></span>
<span class="line"><span style="color:#A6ACCD;">  tag atlassian.access</span></span>
<span class="line"><span style="color:#A6ACCD;">  multiline_flush_interval 5s</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">parse</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    @type multiline</span></span>
<span class="line"><span style="color:#A6ACCD;">	format_firstline /\\d{4}-\\d{1,2}-\\d{1,2} \\d{1,2}:\\d{1,2}:\\d{1,2},\\d{1,3}/</span></span>
<span class="line"><span style="color:#A6ACCD;">    format1 /^(?</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">time</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">\\d{4}-\\d{1,2}-\\d{1,2} \\d{1,2}:\\d{1,2}:\\d{1,2},\\d{1,3})\\s+(?</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">msg</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">.*)/</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">parse</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">source</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">filter</span><span style="color:#89DDFF;"> atlassian.*&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	@type parser</span></span>
<span class="line"><span style="color:#A6ACCD;">	key_name msg</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">parse</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">		@type multi_format</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">pattern</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        	format regexp</span></span>
<span class="line"><span style="color:#A6ACCD;">      		expression /^(?</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">module</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">\\S+)\\s+(?</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">level</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">\\S+)\\s+(?</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">service</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">\\S+)\\s+\\[(?</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">class</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">.*?)\\]\\s+(?</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">msg</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">.*)/</span></span>
<span class="line"><span style="color:#A6ACCD;">    	</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">pattern</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">pattern</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        	format regexp</span></span>
<span class="line"><span style="color:#A6ACCD;">      		expression /^(?</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">module</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">\\S+)\\s+(?</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">level</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">\\S+)\\s+(?</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">user</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">\\S+)\\s+[\\w\\s]+\\s+[\\w\\s]+\\s+(?</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">ip_address</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">[^,]+),[^,\\ ]+\\s+(?</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">url</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">\\S+)\\s+\\[(?</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">class</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">.*?)\\]\\s+(?</span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">message</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">.*)/</span></span>
<span class="line"><span style="color:#A6ACCD;">    	</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">pattern</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">parse</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">filter</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">match</span><span style="color:#89DDFF;"> atlassian.*&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  @type stdout</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">match</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div>`,19),e=[t];function o(c,r,D,F,y,i){return a(),n("div",null,e)}const d=s(p,[["render",o]]);export{A as __pageData,d as default};

import{_ as s,c as a,o as n,a as p}from"./app.852d0fdd.js";const A=JSON.parse('{"title":"\u0423\u0441\u0442\u0430\u043D\u043E\u0432\u043A\u0430","description":"Description of this page","frontmatter":{"lang":"ru-RU","title":"\u0423\u0441\u0442\u0430\u043D\u043E\u0432\u043A\u0430","description":"Description of this page"},"headers":[],"relativePath":"devops/software/airflow/airflow.md","lastUpdated":1665449255000}'),l={name:"devops/software/airflow/airflow.md"},e=p(`<h1 id="airflow-install" tabindex="-1">Airflow install <a class="header-anchor" href="#airflow-install" aria-hidden="true">#</a></h1><p>\u041F\u0435\u0440\u0432\u044B\u043C \u0434\u0435\u043B\u043E\u043C \u0443\u0441\u0442\u0430\u043D\u0430\u0432\u043B\u0438\u0432\u0430\u0435\u043C Python 3.7-3.10 (\u043D\u0430 \u043C\u043E\u043C\u0435\u043D\u0442 \u043D\u0430\u043F\u0438\u0441\u0430\u043D\u0438\u044F \u0434\u043E\u043A\u0443\u043C\u0435\u043D\u0442\u0430) <a href="./../python/python">\u0423\u0441\u0442\u0430\u043D\u043E\u0432\u043A\u0430 Python 3.10.x</a></p><p>\u0423\u0441\u0442\u0430\u043D\u0430\u0432\u043B\u0438\u0432\u0430\u0435\u043C:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">pip3 install </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">apache-airflow[celery]==2.4.1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> --constraint </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://raw.githubusercontent.com/apache/airflow/constraints-2.4.1/constraints-3.7.txt</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><p>\u0421\u043E\u0437\u0434\u0430\u0451\u043C \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">useradd airflow</span></span>
<span class="line"></span></code></pre></div><p>\u0424\u0430\u0439\u043B\u044B \u0441\u043B\u0443\u0436\u0431 Airflow \u043C\u043E\u0436\u043D\u043E \u043D\u0430\u0439\u0442\u0438 \u043F\u043E \u0441\u0441\u044B\u043B\u043A\u0435: <a href="https://github.com/apache/airflow/tree/master/scripts/systemd" target="_blank" rel="noreferrer">https://github.com/apache/airflow/tree/master/scripts/systemd</a></p><p>\u0421\u043E\u0437\u0434\u0430\u0434\u0438\u043C \u0432\u0440\u0435\u043C\u0435\u043D\u043D\u044B\u0439 \u043A\u0430\u0442\u0430\u043B\u043E\u0433:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">mkdir /tmp/airflow-daemon</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> /tmp/airflow-daemon</span></span>
<span class="line"></span></code></pre></div><p>\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u043A\u043E\u043D\u0444\u0438\u0433\u0438:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">wget https://raw.githubusercontent.com/apache/airflow/master/scripts/systemd/airflow</span></span>
<span class="line"><span style="color:#A6ACCD;">wget https://raw.githubusercontent.com/apache/airflow/master/scripts/systemd/airflow-scheduler.service</span></span>
<span class="line"><span style="color:#A6ACCD;">wget https://raw.githubusercontent.com/apache/airflow/master/scripts/systemd/airflow-webserver.service</span></span>
<span class="line"><span style="color:#A6ACCD;">wget https://raw.githubusercontent.com/apache/airflow/master/scripts/systemd/airflow.conf</span></span>
<span class="line"></span></code></pre></div><p>\u041A\u043E\u043F\u0438\u0440\u0443\u0435\u043C \u0444\u0430\u0439\u043B\u044B \u043F\u043E \u043F\u0430\u043F\u043A\u0430\u043C:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">cp </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">.service /usr/lib/systemd/system/</span></span>
<span class="line"><span style="color:#A6ACCD;">cp airflow.conf /usr/lib/tmpfiles.d/</span></span>
<span class="line"><span style="color:#A6ACCD;">cp airflow /etc/sysconfig/</span></span>
<span class="line"></span></code></pre></div><p>\u0421\u043E\u0437\u0434\u0430\u0451\u043C \u043D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u044B\u0435 \u043A\u0430\u0442\u0430\u043B\u043E\u0433\u0438:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">mkdir /run/airflow</span></span>
<span class="line"><span style="color:#A6ACCD;">chown -R airflow:airflow /run/airflow</span></span>
<span class="line"><span style="color:#A6ACCD;">chmod -R 755 /run/airflow</span></span>
<span class="line"></span></code></pre></div><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">mkdir /opt/airflow</span></span>
<span class="line"><span style="color:#A6ACCD;">chown -R airflow:airflow /opt/airflow</span></span>
<span class="line"><span style="color:#A6ACCD;">chmod -R 775 /opt/airflow</span></span>
<span class="line"></span></code></pre></div><p>\u042D\u043A\u0441\u043F\u043E\u0440\u0442\u0438\u0440\u0443\u0435\u043C \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0443\u044E \u0434\u043E\u043C\u0430\u0448\u043D\u0435\u0439 \u0434\u0438\u0440\u0435\u043A\u0442\u043E\u0440\u0438\u0438:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#C792EA;">export</span><span style="color:#A6ACCD;"> AIRFLOW_HOME=/opt/airflow</span></span>
<span class="line"></span></code></pre></div><p>\u0418\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u0443\u0435\u043C \u0431\u0430\u0437\u0443 \u0434\u0430\u043D\u043D\u044B\u0445:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">airflow db init</span></span>
<span class="line"></span></code></pre></div><p>\u042F \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u044E postgresql, \u043F\u0440\u0438 \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0430\u0446\u0438\u0438 \u043F\u043E\u043B\u0443\u0447\u0438\u043B \u043E\u0448\u0438\u0431\u043A\u0443, \u043F\u043E\u0442\u043E\u043C\u0443: \u0423\u0441\u0442\u0430\u043D\u0430\u0432\u043B\u0438\u0432\u0430\u0435\u043C \u0437\u0430\u0432\u0438\u0441\u0438\u0441\u043C\u043E\u0441\u0442\u044C:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">pip3 install psycopg2-binary</span></span>
<span class="line"></span></code></pre></div><p>\u0418 \u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u0443\u0435\u043C \u043A\u043E\u043D\u0444\u0438\u0433 \u0432 /opt/airflow</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">vim /opt/airflow/airflow.cfg</span></span>
<span class="line"></span></code></pre></div><p>\u041D\u0430\u0441\u0442\u0440\u0430\u0438\u0432\u0430\u0435\u043C \u0441\u0442\u0440\u043E\u043A\u0443 \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u044F</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">sql_alchemy_conn = postgresql+psycopg2://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;/&lt;db&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u041F\u043E\u0432\u0442\u043E\u0440\u044F\u0435\u043C \u043A\u043E\u043C\u0430\u043D\u0434\u0443 \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0430\u0446\u0438\u0438</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">airflow db init</span></span>
<span class="line"></span></code></pre></div><p>\u0418\u0449\u0435\u043C \u043A\u0443\u0434\u0430 \u0443\u0441\u0442\u0430\u043D\u043E\u0432\u0438\u043B\u0438 airflow:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">which airflow</span></span>
<span class="line"></span></code></pre></div><p>\u0418\u0437\u043C\u0435\u043D\u044F\u0435\u043C \u043D\u0430\u0448\u0438 \u0434\u0435\u043C\u043E\u043D\u044B:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">vim /usr/lib/systemd/system/airflow-scheduler.service</span></span>
<span class="line"></span></code></pre></div><p>\u0412 \u0441\u0442\u0440\u043E\u043A\u0435 ExecStart \u043F\u0440\u0430\u0432\u0438\u043C \u043F\u0443\u0442\u044C \u0434\u043E \u043D\u0430\u0448\u0435\u0433\u043E \u0444\u0430\u0439\u043B\u0430:</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">ExecStart=/usr/local/bin/airflow scheduler</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u0410\u043D\u0430\u043B\u043E\u0433\u0438\u0447\u043D\u043E \u0438 \u0442\u0443\u0442:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">vim /usr/lib/systemd/system/airflow-webserver.service</span></span>
<span class="line"></span></code></pre></div><p>\u0418\u0437\u043C\u0435\u043D\u044F\u0435\u043C \u0441\u0438\u0441\u0442\u0435\u043C\u043D\u0443\u044E \u043A\u043E\u043D\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044E:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">vim /etc/sysconfig/airflow</span></span>
<span class="line"></span></code></pre></div><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">AIRFLOW_CONFIG=/opt/airflow/airflow.cfg</span></span>
<span class="line"><span style="color:#A6ACCD;">AIRFLOW_HOME=/opt/airflow</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u0412\u043A\u043B\u044E\u0447\u0430\u0435\u043C \u0430\u0432\u0442\u043E\u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0443 \u0438 \u0437\u0430\u043F\u0443\u0441\u043A\u0430\u0435\u043C \u0434\u0435\u043C\u043E\u043D\u044B:</p><div class="language-bash"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">systemctl </span><span style="color:#82AAFF;">enable</span><span style="color:#A6ACCD;"> airflow-scheduler --now</span></span>
<span class="line"><span style="color:#A6ACCD;">systemctl </span><span style="color:#82AAFF;">enable</span><span style="color:#A6ACCD;"> airflow-webserver --now</span></span>
<span class="line"></span></code></pre></div><p>\u0413\u043E\u0442\u043E\u0432\u043E.</p>`,42),o=[e];function c(t,r,i,d,b,u){return n(),a("div",null,o)}const g=s(l,[["render",c]]);export{A as __pageData,g as default};
